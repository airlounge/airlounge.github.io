import React, { useState } from 'react';
import { BookOpen, CloudRain, Brain, Activity, BarChart2, GitBranch, Home, Menu, X, ChevronRight } from 'lucide-react';

const CourseWebsite = () => {
  const [activePage, setActivePage] = useState('home');
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);

  // ë„¤ë¹„ê²Œì´ì…˜ ë°ì´í„° (ë§ˆì¹˜ ì—¬ëŸ¬ ê°œì˜ íŒŒì¼ì²˜ëŸ¼ ë¶„ë¥˜)
  const navItems = [
    { id: 'home', label: 'ê°•ì˜ ì†Œê°œ', icon: Home },
    { id: 'basics', label: '1. ì¸ê³µì§€ëŠ¥ ê¸°ì´ˆ', icon: Brain },
    { id: 'training', label: '2. ëª¨ë¸ í•™ìŠµê³¼ ìµœì í™”', icon: Activity },
    { id: 'deeplearning', label: '3. ë”¥ëŸ¬ë‹ê³¼ ê¸°ìƒ', icon: GitBranch },
    { id: 'application', label: '4. ì‹¤ìŠµ ë° í™œìš©', icon: CloudRain },
  ];

  const renderContent = () => {
    switch (activePage) {
      case 'home': return <HomeSection changePage={setActivePage} />;
      case 'basics': return <BasicsSection />;
      case 'training': return <TrainingSection />;
      case 'deeplearning': return <DeepLearningSection />;
      case 'application': return <ApplicationSection />;
      default: return <HomeSection changePage={setActivePage} />;
    }
  };

  return (
    <div className="min-h-screen bg-slate-50 flex font-sans text-slate-800">
      {/* Sidebar Navigation (Desktop) */}
      <aside className="hidden md:flex flex-col w-64 bg-slate-900 text-white shadow-xl fixed h-full z-10">
        <div className="p-6 border-b border-slate-700">
          <div className="flex items-center gap-2 font-bold text-xl">
            <CloudRain className="text-blue-400" />
            <span>Meteo<span className="text-blue-400">AI</span> Lab</span>
          </div>
          <p className="text-xs text-slate-400 mt-2">í•™ë¶€ìƒì„ ìœ„í•œ ê°•ì˜ ë…¸íŠ¸</p>
        </div>
        <nav className="flex-1 overflow-y-auto py-6">
          <ul className="space-y-1">
            {navItems.map((item) => (
              <li key={item.id}>
                <button
                  onClick={() => setActivePage(item.id)}
                  className={`w-full flex items-center gap-3 px-6 py-3 text-sm font-medium transition-colors ${
                    activePage === item.id 
                      ? 'bg-blue-600 text-white border-r-4 border-blue-300' 
                      : 'text-slate-400 hover:bg-slate-800 hover:text-white'
                  }`}
                >
                  <item.icon size={18} />
                  {item.label}
                </button>
              </li>
            ))}
          </ul>
        </nav>
        <div className="p-6 border-t border-slate-700 text-xs text-slate-500">
          &copy; 2024 Meteorology & AI<br />
          Lecture Notes Visualization
        </div>
      </aside>

      {/* Mobile Header & Menu */}
      <div className="md:hidden fixed top-0 w-full bg-slate-900 text-white z-20 flex justify-between items-center p-4 shadow-md">
        <div className="flex items-center gap-2 font-bold">
          <CloudRain className="text-blue-400" />
          <span>MeteoAI</span>
        </div>
        <button onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}>
          {isMobileMenuOpen ? <X /> : <Menu />}
        </button>
      </div>

      {/* Mobile Navigation Menu Overlay */}
      {isMobileMenuOpen && (
        <div className="md:hidden fixed inset-0 bg-slate-900 z-10 pt-20 px-6">
          <ul className="space-y-4">
            {navItems.map((item) => (
              <li key={item.id}>
                <button
                  onClick={() => {
                    setActivePage(item.id);
                    setIsMobileMenuOpen(false);
                  }}
                  className={`flex items-center gap-3 text-lg font-medium ${
                    activePage === item.id ? 'text-blue-400' : 'text-slate-400'
                  }`}
                >
                  <item.icon size={20} />
                  {item.label}
                </button>
              </li>
            ))}
          </ul>
        </div>
      )}

      {/* Main Content Area */}
      <main className="flex-1 md:ml-64 p-6 md:p-12 mt-16 md:mt-0 transition-all duration-300">
        <div className="max-w-4xl mx-auto bg-white min-h-[85vh] rounded-2xl shadow-sm border border-slate-200 overflow-hidden relative">
          {renderContent()}
        </div>
      </main>
    </div>
  );
};

/* --- Page Components --- */

const HomeSection = ({ changePage }) => (
  <div className="h-full flex flex-col">
    <div className="bg-gradient-to-r from-slate-900 to-blue-900 text-white p-12 text-center relative overflow-hidden">
      <div className="absolute inset-0 opacity-10">
        <svg className="w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none">
          <path d="M0 50 Q 25 30 50 50 T 100 50 V 100 H 0 Z" fill="white" />
          <path d="M0 60 Q 25 40 50 60 T 100 60 V 100 H 0 Z" fill="white" opacity="0.5" />
        </svg>
      </div>
      <h1 className="text-4xl md:text-5xl font-bold mb-4 relative z-10">ê¸°ìƒ ì¸ê³µì§€ëŠ¥ íŠ¹ë¡ </h1>
      <p className="text-blue-200 text-lg relative z-10">Atmospheric Sciences & Artificial Intelligence</p>
    </div>
    
    <div className="p-8 md:p-12 flex-1 flex flex-col justify-center">
      <div className="prose prose-slate max-w-none mb-10">
        <h3 className="text-2xl font-bold text-slate-800 border-b pb-2 mb-4">ê°•ì˜ ê°œìš”</h3>
        <p className="text-slate-600 leading-relaxed">
          ë³¸ ê°•ì˜ ë…¸íŠ¸ëŠ” ê¸°ìƒ ë°ì´í„°ì˜ íŠ¹ì„±ì„ ì´í•´í•˜ê³ , ì´ë¥¼ ì¸ê³µì§€ëŠ¥ ëª¨ë¸ì— ì ìš©í•˜ê¸° ìœ„í•œ 
          í•µì‹¬ ì´ë¡ ê³¼ ì‹¤ìŠµ ë‚´ìš©ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤. ì „í†µì ì¸ ìˆ˜ì¹˜ ì˜ˆë³´ ëª¨ë¸(NWP)ê³¼ 
          í˜„ëŒ€ì ì¸ ë°ì´í„° ê¸°ë°˜(Data-driven) ëª¨ë¸ì˜ ìœµí•©ì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.
        </p>
      </div>

      <div className="grid md:grid-cols-2 gap-6">
        <div className="p-6 bg-blue-50 rounded-xl border border-blue-100 hover:shadow-md transition-shadow cursor-pointer group" onClick={() => changePage('basics')}>
          <div className="flex items-center justify-between mb-2">
            <h4 className="font-bold text-blue-900">ì´ë¡  ê¸°ì´ˆ</h4>
            <Brain className="text-blue-500 group-hover:scale-110 transition-transform" />
          </div>
          <p className="text-sm text-blue-700">ì†ì‹¤í•¨ìˆ˜, ë¹„ìš©í•¨ìˆ˜, ê²½ì‚¬í•˜ê°•ë²• ë“± AI í•µì‹¬ ê°œë… ì •ë¦¬</p>
        </div>
        <div className="p-6 bg-indigo-50 rounded-xl border border-indigo-100 hover:shadow-md transition-shadow cursor-pointer group" onClick={() => changePage('deeplearning')}>
          <div className="flex items-center justify-between mb-2">
            <h4 className="font-bold text-indigo-900">ì‹¬í™” í•™ìŠµ</h4>
            <GitBranch className="text-indigo-500 group-hover:scale-110 transition-transform" />
          </div>
          <p className="text-sm text-indigo-700">CNN, RNN ë“± ê¸°ìƒ ë°ì´í„°ì— íŠ¹í™”ëœ ëª¨ë¸ êµ¬ì¡° í•™ìŠµ</p>
        </div>
      </div>
    </div>
  </div>
);

const BasicsSection = () => (
  <div className="p-8 md:p-12">
    <div className="flex items-center gap-3 text-slate-400 text-sm font-bold uppercase tracking-wider mb-6">
      <Brain size={16} /> 1. Introduction
    </div>
    <h2 className="text-3xl font-bold text-slate-900 mb-8">ì¸ê³µì§€ëŠ¥ê³¼ ê¸°ìƒí•™ì˜ ë§Œë‚¨</h2>
    
    <div className="space-y-12">
      <section>
        <h3 className="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
          <span className="w-1.5 h-6 bg-blue-500 rounded-full"></span>
          ê¸°ìƒ ë°ì´í„°ì˜ íŠ¹ìˆ˜ì„±
        </h3>
        <ul className="list-disc pl-6 space-y-2 text-slate-600 bg-slate-50 p-6 rounded-lg border border-slate-100">
          <li><strong>ë¹„ì„ í˜•ì„± (Non-linearity):</strong> ëŒ€ê¸° í˜„ìƒì€ ì¹´ì˜¤ìŠ¤ì ì´ë©° ë³µì¡í•œ ë¹„ì„ í˜• ê´€ê³„ë¥¼ ê°€ì§.</li>
          <li><strong>ê³ ì°¨ì›ì„± (High-dimensionality):</strong> ìœ„ë„, ê²½ë„, ê³ ë„, ì‹œê°„, ë³€ìˆ˜ ë“± ë°©ëŒ€í•œ ì°¨ì›ì˜ ë°ì´í„°.</li>
          <li><strong>ì‹œê³µê°„ ìƒê´€ì„± (Spatio-temporal correlation):</strong> íŠ¹ì • ì§€ì ì˜ ë‚ ì”¨ëŠ” ì£¼ë³€ ì§€ì—­ ë° ê³¼ê±° ì‹œê°„ì˜ ì˜í–¥ì„ ë°›ìŒ.</li>
        </ul>
      </section>

      <section>
        <h3 className="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
          <span className="w-1.5 h-6 bg-blue-500 rounded-full"></span>
          AI vs ìˆ˜ì¹˜ì˜ˆë³´ (NWP)
        </h3>
        <div className="overflow-x-auto">
          <table className="w-full text-left text-sm text-slate-600 border-collapse">
            <thead>
              <tr className="bg-slate-100 border-b border-slate-200 text-slate-900">
                <th className="p-4 rounded-tl-lg">êµ¬ë¶„</th>
                <th className="p-4">ìˆ˜ì¹˜ì˜ˆë³´ (NWP)</th>
                <th className="p-4 rounded-tr-lg">ì¸ê³µì§€ëŠ¥ (AI)</th>
              </tr>
            </thead>
            <tbody>
              <tr className="border-b border-slate-50">
                <td className="p-4 font-bold">ê¸°ë°˜</td>
                <td className="p-4">ë¬¼ë¦¬ ë°©ì •ì‹ (ë‚˜ë¹„ì—-ìŠ¤í† í¬ìŠ¤ ë“±)</td>
                <td className="p-4">ë°ì´í„° í†µê³„ì  íŒ¨í„´ í•™ìŠµ</td>
              </tr>
              <tr className="border-b border-slate-50">
                <td className="p-4 font-bold">ê³„ì‚° ë¹„ìš©</td>
                <td className="p-4">ë§¤ìš° ë†’ìŒ (ìŠˆí¼ì»´í“¨í„° í•„ìˆ˜)</td>
                <td className="p-4">í•™ìŠµ ì‹œ ë†’ìŒ, ì˜ˆì¸¡ ì‹œ ë§¤ìš° ë‚®ìŒ</td>
              </tr>
              <tr>
                <td className="p-4 font-bold">ì¥ì </td>
                <td className="p-4">ë¬¼ë¦¬ì  í•´ì„ ê°€ëŠ¥, ì‹ ë¢°ì„± ë†’ìŒ</td>
                <td className="p-4">ë³µì¡í•œ ë¹„ì„ í˜• íŒ¨í„´ ë°œê²¬, ë¹ ë¥¸ ê³„ì‚°</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </div>
  </div>
);

const TrainingSection = () => (
  <div className="p-8 md:p-12">
    <div className="flex items-center gap-3 text-slate-400 text-sm font-bold uppercase tracking-wider mb-6">
      <Activity size={16} /> 2. Model Training
    </div>
    <h2 className="text-3xl font-bold text-slate-900 mb-8">ëª¨ë¸ í•™ìŠµê³¼ ìµœì í™”</h2>

    <div className="space-y-12">
      {/* Loss Function Concept Visualization */}
      <section>
        <h3 className="text-xl font-bold text-slate-800 mb-4">ì†ì‹¤í•¨ìˆ˜(Loss) vs ë¹„ìš©í•¨ìˆ˜(Cost)</h3>
        <div className="bg-white border border-slate-200 rounded-xl p-6 shadow-sm">
          <p className="text-slate-600 mb-6">
            ê¸°ìƒì²­ ë…¸íŠ¸ì— ë”°ë¥´ë©´, í•™ìŠµ ë‹¨ìœ„ì— ë”°ë¼ ìš©ì–´ë¥¼ êµ¬ë¶„í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.
          </p>
          <div className="grid md:grid-cols-2 gap-8">
            <div className="bg-orange-50 p-5 rounded-lg border border-orange-100 text-center">
              <h4 className="font-bold text-orange-800 mb-2">ì†ì‹¤ í•¨ìˆ˜ (Loss Function)</h4>
              <div className="text-4xl mb-3">L</div>
              <p className="text-sm text-orange-700">
                <strong>í•˜ë‚˜ì˜ ê´€ì¸¡ì¹˜</strong> ë‹¨ìœ„<br/>
                (Single Data Point)
              </p>
            </div>
            <div className="bg-green-50 p-5 rounded-lg border border-green-100 text-center">
              <h4 className="font-bold text-green-800 mb-2">ë¹„ìš© í•¨ìˆ˜ (Cost Function)</h4>
              <div className="text-4xl mb-3">J</div>
              <p className="text-sm text-green-700">
                <strong>ë°ì´í„° ì…‹ ì „ì²´</strong> (Mini-batch / Full)<br/>
                í‰ê· ì ì¸ ì˜¤ì°¨
              </p>
            </div>
          </div>
        </div>
      </section>

      <section>
        <h3 className="text-xl font-bold text-slate-800 mb-4">ê²½ì‚¬í•˜ê°•ë²• (Gradient Descent)</h3>
        <div className="flex flex-col md:flex-row gap-6 items-center">
          <div className="flex-1">
            <p className="text-slate-600 leading-relaxed mb-4">
              ë¹„ìš©í•¨ìˆ˜ Jë¥¼ ìµœì†Œí™”í•˜ê¸° ìœ„í•´ ê°€ì¤‘ì¹˜(w)ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. 
              ê¸°ìƒ ëª¨ë¸ì—ì„œëŠ” ìˆ˜ë§ì€ ë³€ìˆ˜(ê¸°ì˜¨, ìŠµë„, ê¸°ì•• ë“±)ì˜ ê°€ì¤‘ì¹˜ë¥¼ ì¡°ì ˆí•˜ì—¬ 
              ì˜ˆì¸¡ ì˜¤ì°¨ë¥¼ ì¤„ì—¬ë‚˜ê°‘ë‹ˆë‹¤.
            </p>
            <div className="bg-slate-900 text-blue-300 p-4 rounded-lg font-mono text-sm">
              w_new = w_old - learning_rate * gradient
            </div>
          </div>
          {/* Simple CSS Visualization of Gradient Descent */}
          <div className="w-full md:w-64 h-48 bg-slate-50 border border-slate-200 rounded-lg relative overflow-hidden flex items-end justify-center">
            <svg viewBox="0 0 100 50" className="w-full h-full absolute bottom-0">
              <path d="M0 0 Q 50 100 100 0" fill="none" stroke="#cbd5e1" strokeWidth="2" />
            </svg>
            <div className="absolute top-4 left-10 w-4 h-4 bg-red-500 rounded-full shadow-lg animate-bounce"></div>
            <div className="text-xs text-slate-400 absolute bottom-2">Cost Minimum</div>
          </div>
        </div>
      </section>
    </div>
  </div>
);

const DeepLearningSection = () => (
  <div className="p-8 md:p-12">
    <div className="flex items-center gap-3 text-slate-400 text-sm font-bold uppercase tracking-wider mb-6">
      <GitBranch size={16} /> 3. Deep Learning Models
    </div>
    <h2 className="text-3xl font-bold text-slate-900 mb-8">ê¸°ìƒí•™ì„ ìœ„í•œ ë”¥ëŸ¬ë‹</h2>

    <div className="grid gap-8">
      {/* CNN Card */}
      <div className="bg-white border border-slate-200 rounded-xl p-6 shadow-sm hover:border-blue-300 transition-colors">
        <h3 className="text-xl font-bold text-blue-900 mb-2">CNN (í•©ì„±ê³± ì‹ ê²½ë§)</h3>
        <p className="text-sm text-blue-500 font-bold mb-4 uppercase">Spatial Pattern Recognition</p>
        <div className="flex gap-4">
          <div className="flex-1 text-slate-600 text-sm leading-relaxed">
            <p className="mb-2"><strong>ì ìš©:</strong> ì¼ê¸°ë„ ë¶„ì„, ìœ„ì„±/ë ˆì´ë” ì˜ìƒ ì²˜ë¦¬, íƒœí’ íƒì§€</p>
            <p>ê¸°ìƒ ë°ì´í„°ëŠ” ê²©ì(Grid) í˜•íƒœì˜ ì´ë¯¸ì§€ì™€ ìœ ì‚¬í•©ë‹ˆë‹¤. CNNì€ ì§€ì—­ì ì¸ íŒ¨í„´(ì €ê¸°ì••, ì „ì„  ë“±)ì„ ì¶”ì¶œí•˜ëŠ” ë° íƒì›”í•©ë‹ˆë‹¤.</p>
          </div>
          <div className="w-24 h-24 bg-blue-50 rounded flex items-center justify-center opacity-70">
            <div className="grid grid-cols-3 gap-1">
              {[...Array(9)].map((_, i) => (
                <div key={i} className={`w-4 h-4 rounded-sm ${i % 2 === 0 ? 'bg-blue-400' : 'bg-blue-200'}`}></div>
              ))}
            </div>
          </div>
        </div>
      </div>

      {/* RNN Card */}
      <div className="bg-white border border-slate-200 rounded-xl p-6 shadow-sm hover:border-indigo-300 transition-colors">
        <h3 className="text-xl font-bold text-indigo-900 mb-2">RNN / LSTM / GRU</h3>
        <p className="text-sm text-indigo-500 font-bold mb-4 uppercase">Time Series Prediction</p>
        <div className="flex gap-4">
          <div className="flex-1 text-slate-600 text-sm leading-relaxed">
            <p className="mb-2"><strong>ì ìš©:</strong> ì‹œê³„ì—´ ì˜ˆì¸¡, íƒœí’ ê²½ë¡œ ì¶”ì </p>
            <p>ë‚ ì”¨ëŠ” ì‹œê°„ì˜ íë¦„ì— ë”°ë¥¸ ì—°ì†ì„±ì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ê³¼ê±°ì˜ ìƒíƒœ(Memory)ë¥¼ ê¸°ì–µí•˜ì—¬ ë¯¸ë˜ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ìˆœí™˜ ì‹ ê²½ë§ì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.</p>
          </div>
          <div className="w-24 h-24 bg-indigo-50 rounded flex items-center justify-center opacity-70">
            <div className="flex gap-1 items-center">
              <div className="w-6 h-6 rounded-full border-2 border-indigo-400"></div>
              <ArrowRight size={16} className="text-indigo-300" />
              <div className="w-6 h-6 rounded-full bg-indigo-500"></div>
              <ArrowRight size={16} className="text-indigo-300" />
              <div className="w-6 h-6 rounded-full border-2 border-indigo-400"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
);

const ApplicationSection = () => (
  <div className="p-8 md:p-12">
    <div className="flex items-center gap-3 text-slate-400 text-sm font-bold uppercase tracking-wider mb-6">
      <CloudRain size={16} /> 4. Application
    </div>
    <h2 className="text-3xl font-bold text-slate-900 mb-8">ì‹¤ì „ ì˜ˆì œ: ê°•ìˆ˜ ì˜ˆì¸¡</h2>
    
    <div className="bg-slate-900 text-slate-300 rounded-xl p-6 font-mono text-sm shadow-lg overflow-x-auto">
      <div className="flex items-center gap-2 mb-4 border-b border-slate-700 pb-2">
        <div className="w-3 h-3 rounded-full bg-red-500"></div>
        <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
        <div className="w-3 h-3 rounded-full bg-green-500"></div>
        <span className="ml-2 text-slate-400">weather_prediction.py</span>
      </div>
      <pre>
{`import numpy as np
import tensorflow as tf
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Conv2D, LSTM, Dense

# 1. ë°ì´í„° ì¤€ë¹„ (Radar Images)
# Shape: (Samples, Time, Height, Width, Channels)
radar_data = np.load('radar_reflectivity.npy')

# 2. ConvLSTM ëª¨ë¸ êµ¬ì„± (ì‹œê³µê°„ íŠ¹ì§• ë™ì‹œ ì¶”ì¶œ)
model = Sequential([
    ConvLSTM2D(filters=64, kernel_size=(3, 3),
               input_shape=(None, 100, 100, 1),
               padding='same', return_sequences=True),
    BatchNorm(),
    ConvLSTM2D(filters=32, kernel_size=(3, 3),
               padding='same', return_sequences=False),
    BatchNorm(),
    Conv2D(filters=1, kernel_size=(3, 3),
           activation='sigmoid', padding='same')
])

# 3. ëª¨ë¸ ì»´íŒŒì¼ (ê°•ìˆ˜ ì—¬ë¶€ í™•ë¥ )
model.compile(optimizer='adam', loss='binary_crossentropy')

# 4. í•™ìŠµ ì‹œì‘
history = model.fit(x_train, y_train, epochs=20, batch_size=16)
`}
      </pre>
    </div>
    
    <div className="mt-8 bg-blue-50 border border-blue-100 p-6 rounded-lg text-sm text-blue-800">
      <h4 className="font-bold mb-2">ğŸ’¡ Note</h4>
      <p>
        ìœ„ ì½”ë“œëŠ” ë ˆì´ë” ì˜ìƒì„ ì…ë ¥ë°›ì•„ ë‹¨ì‹œê°„(Nowcasting) ê°•ìˆ˜ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ConvLSTM ëª¨ë¸ì˜ ì˜ˆì‹œì…ë‹ˆë‹¤. 
        CNNì˜ ê³µê°„ì  íŠ¹ì§• ì¶”ì¶œê³¼ LSTMì˜ ì‹œê³„ì—´ ê¸°ì–µ ëŠ¥ë ¥ì„ ê²°í•©í•œ í˜•íƒœì…ë‹ˆë‹¤.
      </p>
    </div>
  </div>
);

export default CourseWebsite;
